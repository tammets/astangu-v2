<!DOCTYPE html>
<html lang="et">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teemakavade Haldus</title>
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://unpkg.com/@tailwindcss/browser@4.0.0"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.462.0/lucide.min.css" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="js/main.js"></script>
    <style>
        :root {
            --background: 0 0% 100%;
            --foreground: 222.2 84% 4.9%;
            --card: 0 0% 100%;
            --card-foreground: 222.2 84% 4.9%;
            --primary: 222.2 47.4% 11.2%;
            --primary-foreground: 210 40% 98%;
            --secondary: 210 40% 96.1%;
            --secondary-foreground: 222.2 47.4% 11.2%;
            --muted: 210 40% 96.1%;
            --muted-foreground: 215.4 16.3% 46.9%;
            --accent: 210 40% 96.1%;
            --accent-foreground: 222.2 47.4% 11.2%;
            --destructive: 0 84.2% 60.2%;
            --destructive-foreground: 210 40% 98%;
            --border: 214.3 31.8% 91.4%;
            --input: 214.3 31.8% 91.4%;
            --ring: 222.2 84% 4.9%;
            --radius: 0.5rem;
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            min-width: 300px;
            padding: 16px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
        }

        .toast.show {
            opacity: 1;
            transform: translateX(0);
        }

        .toast.success {
            background-color: #10b981;
        }

        .toast.error {
            background-color: #ef4444;
        }

        .btn-primary {
            background-color: hsl(var(--primary));
            color: hsl(var(--primary-foreground));
        }

        .btn-primary:hover {
            background-color: hsl(var(--primary) / 0.9);
        }

        .btn-secondary {
            background-color: hsl(var(--secondary));
            color: hsl(var(--secondary-foreground));
        }

        .btn-destructive {
            background-color: hsl(var(--destructive));
            color: hsl(var(--destructive-foreground));
        }

        .btn-outline {
            border: 1px solid hsl(var(--border));
            background-color: transparent;
            color: hsl(var(--foreground));
        }

        .btn-outline:hover {
            background-color: hsl(var(--accent));
        }

        .card {
            background-color: hsl(var(--card));
            color: hsl(var(--card-foreground));
            border: 1px solid hsl(var(--border));
        }

        .input,
        .textarea,
        .select {
            border: 1px solid hsl(var(--border));
            background-color: hsl(var(--background));
        }

        .input:focus,
        .textarea:focus,
        .select:focus {
            border-color: hsl(var(--ring));
            outline: none;
            box-shadow: 0 0 0 2px hsl(var(--ring) / 0.2);
        }
    </style>
    
</head>
<body class="bg-gray-50 min-h-screen flex flex-col">
    <div id="toast-container"></div>

  <!-- Header -->
  <header class="relative inset-x-0 top-0 z-50 py-6 site-header">
    <div class="mx-auto max-w-7xl">
      <div class="px-6 max-w-7xl mx-auto">
        <nav class="main-nav flex items-center justify-between lg:justify-start" aria-label="Global">
          <a href="index.html" class="-m-1.5 p-1.5 flex items-center gap-2">
            <img alt="Astangu logo" class="h-10 w-auto lg:h-12" src="assets/astangu-logo.svg" />
            <span class="sr-only">Astangu</span>
          </a>
          <button type="button" data-menu-open class="-m-2.5 rounded-md p-2.5 lg:hidden">
            <span class="sr-only">Open main menu</span>
            <svg class="size-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
              aria-hidden="true" data-slot="icon">
              <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
            </svg>
          </button>
          <div class="hidden lg:ml-12 lg:flex lg:gap-x-10 lg:items-center lg:justify-between lg:w-full">
            <div class="flex lg:gap-x-10 items-center">
              <a href="index.html" class="text-base font-semibold lg:text-lg">Avaleht</a>
              <div class="relative group">
                <a href="lak-ope-astangul.html"
                  class="text-base font-semibold lg:text-lg inline-flex items-center gap-1">
                  LAK-õpe Astangul
                  <svg class="size-5 text-gray-500" viewBox="0 0 20 20" fill="currentColor"
                    aria-hidden="true">
                    <path fill-rule="evenodd"
                      d="M5.23 7.21a.75.75 0 0 1 1.06.02L10 10.94l3.71-3.71a.75.75 0 1 1 1.06 1.06l-4.24 4.24a.75.75 0 0 1-1.06 0L5.21 8.29a.75.75 0 0 1 .02-1.08Z"
                      clip-rule="evenodd" />
                  </svg>
                </a>
                <div
                  class="absolute left-0 top-full hidden min-w-48 pt-2 group-hover:block group-focus-within:block">
                  <div class="rounded-lg bg-white shadow-lg ring-1 ring-gray-900/10 flex flex-col p-2">
                    <a href="lak-ope-astangul-ajalugu.html"
                      class="rounded-md px-3 py-2 text-base font-medium text-gray-700 hover:bg-gray-50">Ajalugu</a>
                    <a href="lak-ope-astangul-projekti-kirjeldus.html"
                      class="rounded-md px-3 py-2 text-base font-medium text-gray-700 hover:bg-gray-50">Projekti
                      kirjeldus</a>
                    <a href="lak-ope-astangul-edulood.html"
                      class="rounded-md px-3 py-2 text-base font-medium text-gray-700 hover:bg-gray-50">Edulood</a>
                  </div>
                </div>
              </div>
              <div class="relative group">
                <a href="tooriistakast.html"
                  class="text-base font-semibold lg:text-lg inline-flex items-center gap-1">
                  Tööriistakast
                  <svg class="size-5 text-gray-500" viewBox="0 0 20 20" fill="currentColor"
                    aria-hidden="true">
                    <path fill-rule="evenodd"
                      d="M5.23 7.21a.75.75 0 0 1 1.06.02L10 10.94l3.71-3.71a.75.75 0 1 1 1.06 1.06l-4.24 4.24a.75.75 0 0 1-1.06 0L5.21 8.29a.75.75 0 0 1 .02-1.08Z"
                      clip-rule="evenodd" />
                  </svg>
                </a>
                <div
                  class="absolute left-0 top-full hidden min-w-48 pt-2 group-hover:block group-focus-within:block">
                  <div class="rounded-lg bg-white shadow-lg ring-1 ring-gray-900/10 flex flex-col p-2">
                    <a href="teemakavad.html"
                      class="rounded-md px-3 py-2 text-base font-medium text-gray-700 hover:bg-gray-50">Teemakavad</a>
                  </div>
                </div>
              </div>
              <a href="https://edgar.smartzoos.eu/lak/" target="_blank" rel="noopener noreferrer"
                class="text-base font-semibold lg:text-lg">Käsiraamat</a>
              <a href="kontakt.html" class="text-base font-semibold lg:text-lg">Kontakt</a>
            </div>
            <a href="login.html" class="px-4 py-2 rounded-md transition-colors login-button">Logi sisse</a>
          </div>
        </nav>
      </div>
    </div>
    <!-- Mobile menu, show/hide based on menu open state. -->
    <div id="mobile-menu-backdrop" class="lg:hidden fixed inset-0 z-50 hidden bg-black/20"></div>
    <div id="mobile-menu"
      class="mobile-menu lg:hidden fixed inset-y-0 right-0 z-50 w-full overflow-y-auto p-6 sm:max-w-sm sm:ring-1 sm:ring-gray-900/10 hidden">
      <div class="flex items-center justify-between">
        <a href="index.html" class="-m-1.5 p-1.5">
          <span class="sr-only">Astangu</span>
          <img class="h-10 w-auto" src="assets/astangu-logo.svg" alt="" />
        </a>
        <button type="button" data-menu-close class="-m-2.5 rounded-md p-2.5">
          <span class="sr-only">Close menu</span>
          <svg class="size-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
            aria-hidden="true" data-slot="icon">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
          </svg>
        </button>
      </div>
      <div class="mt-6 flow-root">
        <div class="-my-6 divide-y divide-gray-500/10">
          <div class="space-y-2 py-6">
            <a href="index.html"
              class="-mx-3 block rounded-lg px-3 py-2 text-base font-semibold hover:bg-gray-50">Avaleht</a>
            <div class="space-y-2">
              <a href="lak-ope-astangul.html"
                class="-mx-3 block rounded-lg px-3 py-2 text-base font-semibold hover:bg-gray-50">LAK-õpe
                Astangul</a>
              <div class="ml-4 space-y-1">
                <a href="lak-ope-astangul-ajalugu.html"
                  class="-mx-3 block rounded-lg px-3 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50">Ajalugu</a>
                <a href="lak-ope-astangul-projekti-kirjeldus.html"
                  class="-mx-3 block rounded-lg px-3 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50">Projekti
                  kirjeldus</a>
                <a href="lak-ope-astangul-edulood.html"
                  class="-mx-3 block rounded-lg px-3 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50">Edulood</a>
              </div>
            </div>
            <div class="space-y-2">
              <a href="tooriistakast.html"
                class="-mx-3 block rounded-lg px-3 py-2 text-base font-semibold hover:bg-gray-50">Tööriistakast</a>
              <div class="ml-4 space-y-1">
                <a href="teemakavad.html"
                  class="-mx-3 block rounded-lg px-3 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50">Teemakavad</a>
              </div>
            </div>
            <a href="https://edgar.smartzoos.eu/lak/" target="_blank" rel="noopener noreferrer"
              class="-mx-3 block rounded-lg px-3 py-2 text-base font-semibold hover:bg-gray-50">Käsiraamat</a>
            <a href="kontakt.html"
              class="-mx-3 block rounded-lg px-3 py-2 text-base font-semibold hover:bg-gray-50">Kontakt</a>
            <a href="login.html"
              class="-mx-3 block rounded-lg px-3 py-2 text-base font-semibold login-button">Logi sisse</a>
          </div>
        </div>
      </div>
    </div>
  </header>

    <main class="flex-1 bg-white">
        <section class="py-12 sm:py-16">
            <div class="mx-auto max-w-4xl px-4 sm:px-6 lg:px-8">
                <div class="card rounded-lg">
                    <div class="p-6 border-b">
                        <h1 class="heading-cond-bold text-4xl tracking-tight sm:text-5xl" style="color: #5d0f57;">Uue teemakava loomine</h1>
                        <p class="mt-3 text-base text-gray-600">Täida allolev vorm teemakava koostamiseks. Vorm kogub andmed, kuid neid ei salvestata.</p>
                    </div>
                    <div class="p-6">
                        <form id="curriculum-form" class="space-y-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="space-y-2">
                                    <label for="title" class="block text-sm font-medium">Pealkiri *</label>
                                    <input type="text" id="title" class="input w-full px-3 py-1.5 rounded-md" 
                                        placeholder="Näiteks: Emotsioonid" required>
                                </div>
                                <div class="space-y-2">
                                    <label for="subject" class="block text-sm/6 font-medium text-gray-900">Õppeaine *</label>
                                    <div class="grid grid-cols-1">
                                        <select id="subject" class="col-start-1 row-start-1 w-full appearance-none rounded-md bg-white py-1.5 pr-8 pl-3 text-base text-gray-900 border border-gray-300 outline-1 -outline-offset-1 outline-gray-300 focus-visible:outline-2 focus-visible:-outline-offset-2 focus-visible:outline-indigo-600 sm:text-sm/6" required>
                                            <option value="">Vali õppeaine</option>
                                            <option value="Eesti keel">Eesti keel</option>
                                            <option value="Matemaatika">Matemaatika</option>
                                            <option value="Loodusõpetus">Loodusõpetus</option>
                                            <option value="Ajalugu">Ajalugu</option>
                                            <option value="Geograafia">Geograafia</option>
                                            <option value="Füüsika">Füüsika</option>
                                            <option value="Keemia">Keemia</option>
                                            <option value="Bioloogia">Bioloogia</option>
                                        </select>
                                        <svg viewBox="0 0 16 16" fill="currentColor" data-slot="icon" aria-hidden="true" class="pointer-events-none col-start-1 row-start-1 mr-2 size-5 self-center justify-self-end text-gray-500 sm:size-4">
                                            <path d="M4.22 6.22a.75.75 0 0 1 1.06 0L8 8.94l2.72-2.72a.75.75 0 1 1 1.06 1.06l-3.25 3.25a.75.75 0 0 1-1.06 0L4.22 7.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" fill-rule="evenodd" />
                                        </svg>
                                    </div>
                                </div>
                                <div class="space-y-2">
                                    <label for="field" class="block text-sm/6 font-medium text-gray-900">Valdkond *</label>
                                    <div class="grid grid-cols-1">
                                        <select id="field" class="col-start-1 row-start-1 w-full appearance-none rounded-md bg-white py-1.5 pr-8 pl-3 text-base text-gray-900 border border-gray-300 outline-1 -outline-offset-1 outline-gray-300 focus-visible:outline-2 focus-visible:-outline-offset-2 focus-visible:outline-indigo-600 sm:text-sm/6" required>
                                            <option value="">Vali valdkond</option>
                                            <option value="Sotsiaalsed oskused">Sotsiaalsed oskused</option>
                                            <option value="Kognitiivsed oskused">Kognitiivsed oskused</option>
                                            <option value="Emotsionaalsed oskused">Emotsionaalsed oskused</option>
                                            <option value="Kommunikatiivsed oskused">Kommunikatiivsed oskused</option>
                                            <option value="Praktiline tegevus">Praktiline tegevus</option>
                                            <option value="Loovus ja kunstiline väljendus">Loovus ja kunstiline väljendus</option>
                                        </select>
                                        <svg viewBox="0 0 16 16" fill="currentColor" data-slot="icon" aria-hidden="true" class="pointer-events-none col-start-1 row-start-1 mr-2 size-5 self-center justify-self-end text-gray-500 sm:size-4">
                                            <path d="M4.22 6.22a.75.75 0 0 1 1.06 0L8 8.94l2.72-2.72a.75.75 0 1 1 1.06 1.06l-3.25 3.25a.75.75 0 0 1-1.06 0L4.22 7.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" fill-rule="evenodd" />
                                        </svg>
                                    </div>
                                </div>
                                <div class="space-y-2">
                                    <label for="plannedHours" class="block text-sm/6 font-medium text-gray-900">Kavandatud tundide arv</label>
                                    <div class="grid grid-cols-1">
                                        <select id="plannedHours" class="col-start-1 row-start-1 w-full appearance-none rounded-md bg-white py-1.5 pr-8 pl-3 text-base text-gray-900 border border-gray-300 outline-1 -outline-offset-1 outline-gray-300 focus-visible:outline-2 focus-visible:-outline-offset-2 focus-visible:outline-indigo-600 sm:text-sm/6">
                                            <option value="">Vali tundide arv</option>
                                            <option value="1 x 45 minutit">1 x 45 minutit</option>
                                            <option value="2 x 45 minutit">2 x 45 minutit</option>
                                            <option value="3 x 45 minutit">3 x 45 minutit</option>
                                            <option value="4 x 45 minutit">4 x 45 minutit</option>
                                            <option value="5 x 45 minutit">5 x 45 minutit</option>
                                            <option value="6 x 45 minutit">6 x 45 minutit</option>
                                        </select>
                                        <svg viewBox="0 0 16 16" fill="currentColor" data-slot="icon" aria-hidden="true" class="pointer-events-none col-start-1 row-start-1 mr-2 size-5 self-center justify-self-end text-gray-500 sm:size-4">
                                            <path d="M4.22 6.22a.75.75 0 0 1 1.06 0L8 8.94l2.72-2.72a.75.75 0 1 1 1.06 1.06l-3.25 3.25a.75.75 0 0 1-1.06 0L4.22 7.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" fill-rule="evenodd" />
                                        </svg>
                                    </div>
                                </div>
                            </div>

                            <div class="space-y-2">
                                <label for="description" class="block text-sm font-medium">Kirjeldus</label>
                                <textarea id="description" class="textarea w-full px-3 py-2 rounded-md" rows="4"
                                        placeholder="Teemakava kirjeldus..."></textarea>
                            </div>

                            <div class="space-y-2">
                                <label for="subjectOutcomes" class="block text-sm font-medium">Ainealased õpitulemused</label>
                                <textarea id="subjectOutcomes" class="textarea w-full px-3 py-2 rounded-md" rows="3"
                                        placeholder="Näiteks: õpilane tunneb ära põhiemotsioonid; õpilane seletab, missugustes olukordades tekivad teatud emotsioonid..."></textarea>
                            </div>

                            <div class="space-y-2">
                                <label for="languageOutcomes" class="block text-sm font-medium">Keelelised õpitulemused</label>
                                <textarea id="languageOutcomes" class="textarea w-full px-3 py-2 rounded-md" rows="3"
                                        placeholder="Näiteks: õpilane nimetab põhiemotsioone; õpilane tunneb konteksti põhjal ära põhiemotsioonid..."></textarea>
                            </div>

                            <div class="space-y-4">
                                <div class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between">
                                    <h3 class="text-xl font-semibold">Tunnid</h3>
                                    <button type="button" id="add-lesson" class="btn-primary px-4 py-2 rounded-md flex items-center gap-2">
                                        <i data-lucide="plus" class="w-4 h-4"></i>
                                        Lisa tund
                                    </button>
                                </div>
                                <div id="lessons-container" class="space-y-4"></div>
                            </div>

                            <div class="flex justify-end pt-6">
                                <button type="submit" class="btn-primary px-8 py-3 rounded-md text-lg">
                                    Kinnita sisestus
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="mt-auto">
        <div class="footer-section">
            <div class="footer-title">Astangu Kutserehabilitatsiooni Keskus</div>
            <div class="footer-line">
                <span class="footer-item">Astangu 27, 13519 Tallinn</span>
                <span class="footer-item">tel 659 4152; 659 4327</span>
                <span class="footer-item">faks 659 0520</span>
            </div>
            <div class="footer-line">
                <span class="footer-item">astangu@astangu.ee</span>
                <span class="footer-item">www.astangu.ee</span>
            </div>
        </div>
    </footer>

    <script>
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            document.getElementById('toast-container').appendChild(toast);

            setTimeout(() => toast.classList.add('show'), 100);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        function generateId() {
            return Math.random().toString(36).slice(2) + Date.now().toString(36);
        }

        function createLessonForm(lesson, index) {
            const subtopicOptions = ['põhiemotsioonid', 'olukorrad ja emotsioonid', 'emotsioonide väljendamine', 'toimetulekuviisid', 'empaafia', 'suhtlemine'];
            const durations = ['1 x 45 minutit', '2 x 45 minutit', '3 x 45 minutit', '4 x 45 minutit'];

            return `
                <div class="card border-l-4 border-l-blue-500 rounded-lg" data-lesson-id="${lesson.id}">
                    <div class="p-4 border-b flex justify-between items-center">
                        <h3 class="text-lg font-semibold">Tund ${index + 1}</h3>
                        <button type="button" class="btn-destructive px-3 py-1 rounded text-sm remove-lesson" data-lesson-id="${lesson.id}">
                            <i data-lucide="trash-2" class="w-4 h-4 inline mr-1"></i>
                            Eemalda
                        </button>
                    </div>
                    <div class="p-6 space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="space-y-2">
                                <label class="block text-sm font-medium">Tunni pealkiri</label>
                                <input type="text" class="input w-full px-3 py-1.5 rounded-md lesson-title" 
                                       placeholder="Näiteks: Olukorrad ja emotsioonid" value="${lesson.title}">
                            </div>
                            <div class="space-y-2">
                                <label class="block text-sm font-medium">Tunni kestvus</label>
                                <div class="grid grid-cols-1">
                                    <select class="col-start-1 row-start-1 w-full appearance-none rounded-md bg-white py-1.5 pr-8 pl-3 text-base text-gray-900 border border-gray-300 outline-1 -outline-offset-1 outline-gray-300 focus-visible:outline-2 focus-visible:-outline-offset-2 focus-visible:outline-indigo-600 sm:text-sm/6 lesson-duration">
                                        <option value="">Vali kestvus</option>
                                        ${durations.map(d => `<option value="${d}" ${lesson.duration === d ? 'selected' : ''}>${d}</option>`).join('')}
                                    </select>
                                    <svg viewBox="0 0 16 16" fill="currentColor" data-slot="icon" aria-hidden="true" class="pointer-events-none col-start-1 row-start-1 mr-2 size-5 self-center justify-self-end text-gray-500 sm:size-4">
                                        <path d="M4.22 6.22a.75.75 0 0 1 1.06 0L8 8.94l2.72-2.72a.75.75 0 1 1 1.06 1.06l-3.25 3.25a.75.75 0 0 1-1.06 0L4.22 7.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" fill-rule="evenodd" />
                                    </svg>
                                </div>
                            </div>
                        </div>

                        <div class="space-y-2">
                            <label class="block text-sm font-medium">Alamteema (mitmikvalik)</label>
                            <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                                ${subtopicOptions.map(subtopic => `
                                    <label class="flex items-center space-x-2 cursor-pointer">
                                        <input type="checkbox" class="lesson-subtopic" value="${subtopic}" 
                                               ${lesson.subtopics.includes(subtopic) ? 'checked' : ''}>
                                        <span class="text-sm">${subtopic}</span>
                                    </label>
                                `).join('')}
                            </div>
                        </div>

                        <div class="space-y-2">
                            <label class="block text-sm font-medium">Tunni keeleline eesmärk</label>
                            <input type="text" class="input w-full px-3 py-1.5 rounded-md lesson-language-goal" 
                                   placeholder="Näiteks: Uue sõnavara tutvustamine ja harjutamine" value="${lesson.languageGoal}">
                        </div>

                        <div class="space-y-2">
                            <label class="block text-sm font-medium">Tunni õpiväljundid</label>
                            <textarea class="textarea w-full px-3 py-2 rounded-md lesson-outcomes" rows="3"
                                      placeholder="Näiteks: õpilane tunneb ära põhiemotsioonid; õpilane seletab...">${lesson.outcomes}</textarea>
                        </div>

                        <div class="space-y-2">
                            <label class="block text-sm font-medium">Tunnis käsitletavad mõisted</label>
                            <textarea class="textarea w-full px-3 py-2 rounded-md lesson-concepts" rows="4"
                                      placeholder="Näiteks: Põhiemotsioonid: rõõm, viha, üllatus, kurbus...">${lesson.concepts}</textarea>
                        </div>

                        <div class="space-y-4">
                            <div class="flex justify-between items-center">
                                <label class="text-base font-medium">Tunni käik</label>
                                <button type="button" class="btn-primary px-3 py-1 rounded text-sm add-activity" data-lesson-id="${lesson.id}">
                                    <i data-lucide="plus" class="w-4 h-4 inline mr-1"></i>
                                    Lisa tegevus
                                </button>
                            </div>
                            <div class="activities-container" data-lesson-id="${lesson.id}">
                                ${lesson.activities.length > 0 ? `
                                    <div class="grid grid-cols-4 gap-2 p-3 bg-gray-50 rounded-lg text-sm font-medium mb-3">
                                        <div>Tunni osad</div>
                                        <div>Arendatavad osaoskused</div>
                                        <div>Plaanitud tegevused</div>
                                        <div>Materjalid ja vahendid</div>
                                    </div>
                                    ${lesson.activities.map(activity => createActivityRow(activity)).join('')}
                                ` : ''}
                            </div>
                        </div>

                        <div class="space-y-2">
                            <label class="block text-sm font-medium">Lõimingu võimalused teiste ainetega</label>
                            <textarea class="textarea w-full px-3 py-2 rounded-md lesson-integration" rows="3"
                                      placeholder="Näiteks: Lõiming ainega 'Arvutiõpetus'...">${lesson.integration}</textarea>
                        </div>

                        <div class="space-y-2">
                            <label class="block text-sm font-medium">Tegevuste diferentseerimise ja lisaarendamise võimalused</label>
                            <textarea class="textarea w-full px-3 py-2 rounded-md lesson-differentiation" rows="3"
                                      placeholder="Näiteks: 4. ülesannet õpilased saavad teha edasi paaristööna...">${lesson.differentiation}</textarea>
                        </div>

                        <div class="space-y-2">
                            <label class="block text-sm font-medium">Enese- ja tunnianalüüs õpetajale</label>
                            <textarea class="textarea w-full px-3 py-2 rounded-md lesson-self-analysis" rows="3"
                                      placeholder="Näiteks: Mis tänases tunnis õnnestus? Mis ei õnnestunud? Miks?">${lesson.selfAnalysis}</textarea>
                        </div>
                    </div>
                </div>
            `;
        }

        function createActivityRow(activity) {
            return `
                <div class="grid grid-cols-4 gap-2 p-3 border rounded-lg bg-white relative activity-row" data-activity-id="${activity.id}">
                    <button type="button" class="absolute -right-3 -top-3 w-7 h-7 p-0 flex items-center justify-center btn-destructive rounded-full text-xs remove-activity" data-activity-id="${activity.id}">
                        <i data-lucide="trash-2" class="w-4 h-4"></i>
                    </button>
                    <textarea class="textarea text-sm activity-part" rows="2" placeholder="1. Emotsioonide laul">${activity.part}</textarea>
                    <textarea class="textarea text-sm activity-skills" rows="2" placeholder="kuulamine, rääkimine">${activity.skills}</textarea>
                    <textarea class="textarea text-sm activity-activities" rows="2" placeholder="Õppijad kuulavad emotsioonide laulu...">${activity.activities}</textarea>
                    <textarea class="textarea text-sm activity-materials" rows="2" placeholder="https://www.youtube.com/...">${activity.materials}</textarea>
                </div>
            `;
        }

        function updateLessonHeadings() {
            document.querySelectorAll('[data-lesson-id]').forEach((lessonEl, index) => {
                const heading = lessonEl.querySelector('h3');
                if (heading) {
                    heading.textContent = `Tund ${index + 1}`;
                }
            });
        }

        function addLesson(prefilledLesson) {
            const lesson = prefilledLesson || {
                id: generateId(),
                title: '',
                subtopics: [],
                languageGoal: '',
                duration: '',
                outcomes: '',
                concepts: '',
                activities: [],
                integration: '',
                differentiation: '',
                selfAnalysis: ''
            };

            const lessonsContainer = document.getElementById('lessons-container');
            const lessonCount = lessonsContainer.querySelectorAll('[data-lesson-id]').length;
            lessonsContainer.insertAdjacentHTML('beforeend', createLessonForm(lesson, lessonCount));
            lucide.createIcons();
            updateLessonHeadings();
        }

        function removeLesson(lessonId) {
            const lesson = document.querySelector(`[data-lesson-id="${lessonId}"]`);
            if (lesson) {
                lesson.remove();
                updateLessonHeadings();
            }
        }

        function addActivity(lessonId) {
            const activity = {
                id: generateId(),
                part: '',
                skills: '',
                activities: '',
                materials: ''
            };

            const container = document.querySelector(`.activities-container[data-lesson-id="${lessonId}"]`);
            if (!container) {
                return;
            }

            if (container.children.length === 0) {
                container.innerHTML = `
                    <div class="grid grid-cols-4 gap-2 p-3 bg-gray-50 rounded-lg text-sm font-medium mb-3">
                        <div>Tunni osad</div>
                        <div>Arendatavad osaoskused</div>
                        <div>Plaanitud tegevused</div>
                        <div>Materjalid ja vahendid</div>
                    </div>
                `;
            }

            container.insertAdjacentHTML('beforeend', createActivityRow(activity));
            lucide.createIcons();
        }

        function removeActivity(activityId) {
            const row = document.querySelector(`[data-activity-id="${activityId}"]`);
            if (row) {
                const container = row.closest('.activities-container');
                row.remove();
                const remainingActivities = container?.querySelectorAll('.activity-row').length || 0;
                if (container && remainingActivities === 0) {
                    container.innerHTML = '';
                }
            }
        }

        function getFormData() {
            const data = {
                title: document.getElementById('title').value.trim(),
                description: document.getElementById('description').value.trim(),
                subject: document.getElementById('subject').value,
                field: document.getElementById('field').value,
                plannedHours: document.getElementById('plannedHours').value,
                subjectOutcomes: document.getElementById('subjectOutcomes').value.trim(),
                languageOutcomes: document.getElementById('languageOutcomes').value.trim(),
                lessons: []
            };

            document.querySelectorAll('[data-lesson-id]').forEach(lessonEl => {
                const lessonId = lessonEl.dataset.lessonId;
                const subtopics = Array.from(lessonEl.querySelectorAll('.lesson-subtopic:checked')).map(cb => cb.value);
                const activities = [];

                lessonEl.querySelectorAll('.activity-row').forEach(activityEl => {
                    activities.push({
                        id: activityEl.dataset.activityId,
                        part: activityEl.querySelector('.activity-part').value.trim(),
                        skills: activityEl.querySelector('.activity-skills').value.trim(),
                        activities: activityEl.querySelector('.activity-activities').value.trim(),
                        materials: activityEl.querySelector('.activity-materials').value.trim()
                    });
                });

                data.lessons.push({
                    id: lessonId,
                    title: lessonEl.querySelector('.lesson-title').value.trim(),
                    subtopics,
                    languageGoal: lessonEl.querySelector('.lesson-language-goal').value.trim(),
                    duration: lessonEl.querySelector('.lesson-duration').value,
                    outcomes: lessonEl.querySelector('.lesson-outcomes').value.trim(),
                    concepts: lessonEl.querySelector('.lesson-concepts').value.trim(),
                    activities,
                    integration: lessonEl.querySelector('.lesson-integration').value.trim(),
                    differentiation: lessonEl.querySelector('.lesson-differentiation').value.trim(),
                    selfAnalysis: lessonEl.querySelector('.lesson-self-analysis').value.trim()
                });
            });

            return data;
        }

        document.addEventListener('DOMContentLoaded', function() {
            lucide.createIcons();

            document.getElementById('add-lesson').addEventListener('click', function() {
                addLesson();
            });

            document.getElementById('curriculum-form').addEventListener('submit', function(event) {
                event.preventDefault();
                const data = getFormData();

                if (!data.title || !data.subject || !data.field) {
                    showToast('Palun täitke kõik kohustuslikud väljad', 'error');
                    return;
                }

                console.log('Teemakava andmed', data);
                showToast('Vorm on edukalt täidetud (andmeid ei salvestata).');
            });

            document.addEventListener('click', function(event) {
                const removeLessonBtn = event.target.closest('.remove-lesson');
                if (removeLessonBtn) {
                    removeLesson(removeLessonBtn.dataset.lessonId);
                    return;
                }

                const addActivityBtn = event.target.closest('.add-activity');
                if (addActivityBtn) {
                    addActivity(addActivityBtn.dataset.lessonId);
                    return;
                }

                const removeActivityBtn = event.target.closest('.remove-activity');
                if (removeActivityBtn) {
                    removeActivity(removeActivityBtn.dataset.activityId);
                }
            });
        });
    </script>
</body>
</html>
